# Kidlock Dynamic Dashboard
# Automatically discovers all kidlock entities - no hardcoded hostnames or usernames.
#
# REQUIREMENTS (install via HACS > Frontend):
#   - auto-entities (https://github.com/thomasloven/lovelace-auto-entities)
#   - mushroom (mushroom-cards)
#   - bar-card
#
# SETUP:
#   1. In HA, go to Settings > Dashboards > Add Dashboard
#   2. Open it, click â‹® > Edit Dashboard > Raw configuration editor
#   3. Paste this entire file and save

title: Screen Time
views:
  - title: Screen Time
    path: screen-time
    icon: mdi:laptop
    badges: []
    cards:

      # ============================================================
      # DEVICE STATUS
      # Auto-discovers all kidlock devices
      # ============================================================

      - type: custom:auto-entities
        card:
          type: entities
          title: Devices
          show_header_toggle: false
        filter:
          include:
            - entity_id: binary_sensor.kidlock_*_online
              options:
                secondary_info: last-changed

      # ============================================================
      # USER STATUS OVERVIEW
      # Shows status + time remaining at a glance for all users
      # ============================================================

      - type: custom:auto-entities
        card:
          type: glance
          title: Status Overview
          show_state: true
        filter:
          include:
            - entity_id: sensor.kidlock_*_status

      # ============================================================
      # TIME REMAINING GAUGES
      # One gauge per user, auto-discovered
      # ============================================================

      - type: custom:auto-entities
        card:
          type: grid
          title: Time Remaining
          columns: 2
          square: false
        card_param: cards
        filter:
          include:
            - entity_id: sensor.kidlock_*_time_remaining
              options:
                type: gauge
                min: 0
                max: 180
                needle: true
                severity:
                  green: 30
                  yellow: 10
                  red: 0
                unit: min

      # ============================================================
      # USAGE TODAY
      # Auto-discovered usage sensors
      # ============================================================

      - type: custom:auto-entities
        card:
          type: entities
          title: Usage Today
          show_header_toggle: false
        filter:
          include:
            - entity_id: sensor.kidlock_*_usage
            - entity_id: sensor.kidlock_*_daily_limit

      # ============================================================
      # CURRENT ACTIVITY
      # What they're doing right now
      # ============================================================

      - type: custom:auto-entities
        card:
          type: entities
          title: Activity
          show_header_toggle: false
        filter:
          include:
            - entity_id: binary_sensor.kidlock_*_active
            - entity_id: binary_sensor.kidlock_*_idle
            - entity_id: sensor.kidlock_*_current_app
            - entity_id: sensor.kidlock_*_top_app
            - entity_id: sensor.kidlock_*_top_app_time

      # ============================================================
      # CONTROLS
      # Pause switches, lock/unlock buttons, add time
      # ============================================================

      - type: custom:auto-entities
        card:
          type: entities
          title: Timer Controls
          show_header_toggle: false
        filter:
          include:
            - entity_id: switch.kidlock_*_paused

      - type: custom:auto-entities
        card:
          type: grid
          title: Quick Actions
          columns: 4
          square: false
        card_param: cards
        filter:
          include:
            - entity_id: button.kidlock_*_add_15min
              options:
                type: button
                name: "+15 min"
                icon: mdi:clock-plus
                icon_height: 30px
                tap_action:
                  action: call-service
                  service: button.press
                  target:
                    entity_id: this.entity_id
            - entity_id: button.kidlock_*_add_30min
              options:
                type: button
                name: "+30 min"
                icon: mdi:clock-plus-outline
                icon_height: 30px
                tap_action:
                  action: call-service
                  service: button.press
                  target:
                    entity_id: this.entity_id
            - entity_id: button.kidlock_*_lock
              options:
                type: button
                name: Lock
                icon: mdi:lock
                icon_height: 30px
                tap_action:
                  action: call-service
                  service: button.press
                  target:
                    entity_id: this.entity_id
            - entity_id: button.kidlock_*_unlock
              options:
                type: button
                name: Unlock
                icon: mdi:lock-open
                icon_height: 30px
                tap_action:
                  action: call-service
                  service: button.press
                  target:
                    entity_id: this.entity_id

      # ============================================================
      # TIME REQUESTS
      # Shows pending requests from kids (auto-hides when empty)
      # ============================================================

      - type: custom:auto-entities
        card:
          type: entities
          title: Time Requests
          show_header_toggle: false
        show_empty: false
        filter:
          include:
            - entity_id: binary_sensor.kidlock_*_request_pending
              state: "on"
            - entity_id: sensor.kidlock_*_request_reason
            - entity_id: sensor.kidlock_*_request_minutes
            - entity_id: button.kidlock_*_approve_request
            - entity_id: button.kidlock_*_deny_request

      # ============================================================
      # ALERTS
      # Tamper detection, blocked status
      # ============================================================

      - type: custom:auto-entities
        card:
          type: entities
          title: Alerts
          show_header_toggle: false
        show_empty: false
        filter:
          include:
            - entity_id: binary_sensor.kidlock_*_blocked
              state: "on"
            - entity_id: binary_sensor.kidlock_*_clock_tamper
              state: "on"

      # ============================================================
      # USAGE HISTORY
      # Week-long graph, auto-discovers all usage sensors
      # ============================================================

      - type: custom:auto-entities
        card:
          type: history-graph
          title: Usage History (7 days)
          hours_to_show: 168
        card_param: entities
        filter:
          include:
            - entity_id: sensor.kidlock_*_usage
