# Kidlock Home Assistant Package - Optional Extras
#
# Entities are auto-discovered via MQTT - this file is optional.
# Use this for custom automations, input helpers, etc.

# Input helpers for website blocking (optional)
input_boolean:
  kidlock_blocking_enabled:
    name: "Website Blocking"
    icon: mdi:shield-lock

input_text:
  kidlock_whitelist:
    name: "Allowed Websites"
    max: 2048
    icon: mdi:format-list-bulleted
    # Comma-separated: "google.com, youtube.com, school.edu"

# Example automation to publish blocking settings
# Adjust the hostname in the topic to match your device
automation:
  - id: kidlock_publish_blocking_settings
    alias: "Kidlock: Publish Blocking Settings"
    description: "Push website blocking settings when changed"
    mode: restart
    trigger:
      - platform: state
        entity_id:
          - input_boolean.kidlock_blocking_enabled
          - input_text.kidlock_whitelist
      - platform: homeassistant
        event: start
    action:
      - delay:
          seconds: 5
      # Publish to each device - adjust hostnames as needed
      - service: mqtt.publish
        data:
          topic: "parental/{{ states('sensor.kidlock_hostname') | default('localhost') }}/settings"
          payload: >
            {
              "blocking_enabled": {{ is_state('input_boolean.kidlock_blocking_enabled', 'on') | lower }},
              "whitelist": "{{ states('input_text.kidlock_whitelist') }}"
            }
          retain: true

# Example: Notify when time limit reached
automation kidlock_notify_blocked:
  - id: kidlock_notify_when_blocked
    alias: "Kidlock: Notify When Blocked"
    trigger:
      - platform: state
        entity_id: binary_sensor.kidlock_myhost_kid_blocked
        to: "on"
    action:
      - service: notify.mobile_app
        data:
          title: "Kidlock"
          message: "Time limit reached - user logged out"
